(function(e){function t(t){for(var n,o,i=t[0],c=t[1],u=t[2],l=0,h=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(h.length)h.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,i=1;i<s.length;i++){var c=s[i];0!==r[c]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var n={},r={app:0},a=[];function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var d=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"024a":function(e,t,s){},"0427":function(e,t,s){"use strict";s("edc9")},"09e0":function(e,t,s){},"12fe":function(e,t,s){"use strict";s("e65d")},"2b56":function(e,t,s){"use strict";s("09e0")},5024:function(e,t,s){"use strict";s("64a6")},5043:function(e,t,s){"use strict";s("e4cd")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var n,r=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},o=[],i=s("2877"),c={},u=Object(i["a"])(c,a,o,!1,null,null,null),d=u.exports,l=s("2f62"),h=(s("c975"),s("b0c0"),s("b64b"),s("07ac"),s("5530")),m=(s("96cf"),s("1da1")),p=s("bc3a"),_=s.n(p);s("ac1f"),s("5319");function f(){n=new WebSocket(location.origin.replace(/^http/,"ws")+"/socket/mainSocket"),n.onopen=function(){console.log("ws onopen")},n.onclose=function(e){if(e.wasClean?console.log("websocket closed cleanly: ",e.code):console.log("rip websocket",e),1e3!=e.code){var t=new XMLHttpRequest;t.open("POST","/api/error"),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify({timestamp:Date.now(),error:"websocket closed for suspicous reason",extra:{code:e.code,reason:e.reason}}))}setTimeout((function(){console.log("Trying to reconnect to ws in 2 seconds..."),f()}),2e3)},n.onerror=function(e){var t=new XMLHttpRequest;t.open("POST","/api/error"),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify({timestamp:Date.now(),error:"websocket error",extra:e}))}}function g(e){n.onmessage=function(t){console.log("ws receiving:\n"+t.data);var s=JSON.parse(t.data);e(s)}}function v(e){return n&&1===n.readyState?(console.log("ws sending:\n"+JSON.stringify(e)),n.send(JSON.stringify(e)),!0):(console.log("sendToServer called on a socket that is not open anymore...",n),!1)}var b={active_test_id:null,active_chat:null,tests:{},users:{},latest_announcement:{show:!1,message:{content:"test content"}},CHAT_ANNOUNCEMENTS_NAME:"Announcements",CHAT_ANNOUNCEMENTS:0,CHAT_GROUP:1,CHAT_GROUP_NAME:"Teacher chat",CHAT_ONETOONE:2},C={active_test:function(e){return e.tests[e.active_test_id]}},w={loadTest:function(e,t){return Object(m["a"])(regeneratorRuntime.mark((function s(){var n,r,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:n=e.commit,r=e.dispatch,a=t.test_id,_.a.get("/tests/"+a).then((function(e){for(var t=0,s=Object.values(e.data.chats);t<s.length;t++){var r=s[t];r.type=b.CHAT_ONETOONE}e.data.chats&&e.data.chats[b.CHAT_ANNOUNCEMENTS_NAME]&&(e.data.chats[b.CHAT_ANNOUNCEMENTS_NAME].type=b.CHAT_ANNOUNCEMENTS),e.data.chats&&e.data.chats[b.CHAT_GROUP_NAME]&&(e.data.chats[b.CHAT_GROUP_NAME].type=b.CHAT_GROUP),n("setTest",{test_id:e.data.test_id,test:e.data})})).catch((function(e){r("throwError",{error:"Error while getting test info "+e},{root:!0})}));case 3:case"end":return s.stop()}}),s)})))()},loadUsers:function(e,t){return Object(m["a"])(regeneratorRuntime.mark((function s(){var n,r,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:n=e.commit,r=e.dispatch,a=t.test_id,_.a.get("/tests/"+a+"/users").then((function(e){var t=e.data.students;t?0!==Object.keys(t).length&&n("addUsers",{users:t}):r("throwError",{error:"Error while getting test users: no students object"},{root:!0});var s=e.data.teachers;for(var a in s)s[a].is_supervisor=!0;s?0!==Object.keys(s).length&&n("addUsers",{users:s}):r("throwError",{error:"Error while getting test users: no teachers object"},{root:!0})})).catch((function(e){r("throwError",{error:"Error while getting test users: "+e},{root:!0})}));case 3:case"end":return s.stop()}}),s)})))()},sendWsMessage:function(e,t){return Object(m["a"])(regeneratorRuntime.mark((function s(){var n,r,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:n=e.dispatch,r=t.message,a=v(r),a||n("throwError",{error:"Error while sending message:s ending over websocket failed"},{root:!0});case 4:case"end":return s.stop()}}),s)})))()},receivedWsMessage:function(e,t){var s=e.dispatch;switch(t.messageType||s("throwError",{error:"Error on received websocket message: no message type specified"},{root:!0}),t.receiverIds||s("throwError",{error:"Error on received websocket message: this message was not intended for you"},{root:!0}),t.messageType){case"message_final":s("receivedChatMessage",{message:t.message});break;case"conversation_unread":s("receivedMessageUnread",{message:t.message});break;case"conversation_assigned":s("receivedMessageAssigned",{message:t.message});break;case"message_delete":s("receivedMessageDeleted",{message:t.message});break;case"message_edit":s("receivedChatMessage",{message:t.message});break;case"conversation_typing":s("receivedConversationTyping",{message:t.message});break}},receivedChatMessage:function(e,t){var s=e.commit,n=e.dispatch,r=t.message;console.log("test.js receivedChatMessage",r),"undefined"!==typeof r.test_id&&null!=r.test_id&&b.tests[r.test_id]?"undefined"!==typeof r.chat_id&&null!=r.chat_id&&b.tests[r.test_id].chats[r.chat_id]?"undefined"!==typeof r.sender_id&&null!=r.sender_id?("undefined"!==typeof r.message_id&&null!=r.message_id&&r.timestamp&&r.content||n("throwError",{error:"Error on received message: received a message where not all required fields are present"},{root:!0}),b.active_chat&&b.active_chat.chat_id==r.chat_id?b.active_chat.name!==b.CHAT_ANNOUNCEMENTS_NAME&&b.active_chat.name!==b.CHAT_GROUP_NAME&&n("updateChatUnread",{chat:b.tests[r.test_id].chats[r.chat_id],number_of_unread:0,force:!0}):b.tests[r.test_id].chats[r.chat_id].messages[r.sender_id+":"+r.message_id]||s("incrementChatUnread",{chat:b.tests[r.test_id].chats[r.chat_id]}),s("addChatMessage",{message:r}),console.log(b.tests[r.test_id].chats[r.chat_id].messages[r.sender_id+":"+r.message_id]),b.tests[r.test_id].chats[r.chat_id].messages[r.sender_id+":"+r.message_id]||s("setLatestChatMessage",{message:r}),b.tests[r.test_id].chats[r.chat_id].name===b.CHAT_ANNOUNCEMENTS_NAME&&(s("setLatestAnnouncementMessage",{message:r}),s("setLatestAnnouncementShow",{show:!0}),n("showDesktopNotification",{content:"New announcement"},{root:!0}))):n("throwError",{error:"Error on received message: received a message for a sender that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received message: received a message for a chat that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received message: received a message for a test that doesn't exist for this user"},{root:!0})},receivedMessageUnread:function(e,t){var s=e.commit,n=e.dispatch,r=t.message;"undefined"!==typeof r.test_id&&null!=r.test_id&&b.tests[r.test_id]?"undefined"!==typeof r.chat_id&&null!=r.chat_id&&b.tests[r.test_id].chats[r.chat_id]?void 0!==r.unread&&(b.active_chat&&b.active_chat.chat_id==r.chat_id||s("setChatUnread",{chat:b.tests[r.test_id].chats[r.chat_id],number_of_unread:r.unread})):n("throwError",{error:"Error on received message unread: received a message unread update for a chat that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received message unread: received a message unread update for a test that doesn't exist for this user"},{root:!0})},receivedMessageAssigned:function(e,t){var s=e.commit,n=e.dispatch,r=t.message;if(r.test_id&&b.tests[r.test_id])if(r.chat_id&&b.tests[r.test_id].chats[r.chat_id])if(r.user_id&&("NULL"===r.user_id||b.tests[r.test_id].chats[r.chat_id].people[r.user_id]))if("NULL"===r.user_id)s("setChatAssigned",{chat:b.tests[r.test_id].chats[r.chat_id],name:null});else{var a=b.tests[r.test_id].chats[r.chat_id].people[r.user_id].name;s("setChatAssigned",{chat:b.tests[r.test_id].chats[r.chat_id],name:a.substr(0,a.indexOf(","))})}else n("throwError",{error:"Error on received assigned chat: received an update for a conversation that doesn't exist for this user"},{root:!0});else n("throwError",{error:"Error on received assigned chat: received an update for a chat that doesn't exist for this user"},{root:!0});else n("throwError",{error:"Error on received assigned chat: received an update for a test that doesn't exist for this user"},{root:!0})},receivedMessageDeleted:function(e,t){var s=e.commit,n=e.dispatch,r=t.message;r.test_id&&b.tests[r.test_id]?r.chat_id&&b.tests[r.test_id].chats[r.chat_id]?r.sender_id?r.message_id&&b.tests[r.test_id].chats[r.chat_id].messages[r.sender_id+":"+r.message_id]?(s("removeChatMessage",{message:b.tests[r.test_id].chats[r.chat_id].messages[r.sender_id+":"+r.message_id]}),b.tests[r.test_id].chats[r.chat_id].name===b.CHAT_ANNOUNCEMENTS_NAME&&r.message_id===b.latest_announcement.message.message_id&&s("setLatestAnnouncementShow",{show:!1})):n("throwError",{error:"Error on received deleted message: received an update for a message that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received deleted message: received a message where not all required fields are present"},{root:!0}):n("throwError",{error:"Error on received deleted message: received an update for a chat that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received deleted message: received an update for a test that doesn't exist for this user"},{root:!0})},updateChatUnread:function(e,t){var s=e.commit,n=e.dispatch,r=e.getters,a=e.rootState,o=t.chat,i=t.number_of_unread,c=t.force;if(o.unread!=i|!0===c&&(s("setChatUnread",{chat:o,number_of_unread:i}),o.name!=b.CHAT_ANNOUNCEMENTS_NAME&&o.name!=b.CHAT_GROUP_NAME&&r.active_test.people[a.app.current_user.user_id].is_supervisor)){var u=Object.values(o.people),d=[];for(var l in u)r.active_test.people[u[l].user_id]&&!0===r.active_test.people[u[l].user_id].is_supervisor&&d.push(""+u[l].user_id);var h={messageType:"conversation_unread",receiverIds:d,message:{test_id:o.test_id,chat_id:o.chat_id,unread:i}};n("sendWsMessage",{message:h})}},receivedConversationTyping:function(e,t){var s=e.commit,n=e.dispatch,r=t.message;r.test_id&&b.tests[r.test_id]?r.chat_id&&b.tests[r.test_id].chats[r.chat_id]?r.user_id&&"NULL"!==r.user_id&&b.tests[r.test_id].chats[r.chat_id].people[r.user_id]?r.typing?s("addChatTyping",{chat:b.tests[r.test_id].chats[r.chat_id],user_id:r.user_id}):s("removeChatTyping",{chat:b.tests[r.test_id].chats[r.chat_id],user_id:r.user_id}):n("throwError",{error:"Error on received conversation typing: received an update for a conversation that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received conversation typing: received an update for a chat that doesn't exist for this user"},{root:!0}):n("throwError",{error:"Error on received conversation typing: received an update for a test that doesn't exist for this user"},{root:!0})}},y={setActiveTestId:function(e,t){e.active_test_id=parseInt(t)},setActiveChatById:function(e,t){e.active_chat=e.tests[e.active_test_id].chats[t]},setActiveChat:function(e,t){e.active_chat=t},setTest:function(e,t){var s=t.test_id,n=t.test;r["default"].set(e.tests,s,n)},setTestName:function(e,t){var s=t.test_id,n=t.name;r["default"].set(e.tests[s],"name",n)},setTestChats:function(e,t){var s=t.test_id,n=t.chats;r["default"].set(e.tests[s],"chats",n)},setUsers:function(e,t){e.users=t},setChatUnread:function(e,t){var s=t.chat,n=t.number_of_unread;r["default"].set(s,"unread",n)},setChatAssigned:function(e,t){var s=t.chat,n=t.name;r["default"].set(s,"assigned",n)},incrementChatUnread:function(e,t){var s=t.chat;s.number_of_unread?r["default"].set(s,"unread",s.number_of_unread+1):r["default"].set(s,"unread",1)},decrementChatUnread:function(e,t){var s=t.chat;s.number_of_unread&&s.number_of_unread>0?r["default"].set(s,"unread",s.number_of_unread-1):r["default"].set(s,"unread",0)},addChatTyping:function(e,t){var s=t.chat,n=t.user_id;s.typing||r["default"].set(s,"typing",{}),r["default"].set(s.typing,n,!0)},removeChatTyping:function(e,t){var s=t.chat,n=t.user_id;s.typing&&s.typing[n]&&r["default"].set(s.typing,n,!1)},addChat:function(e,t){var s=t.chat;r["default"].set(e.tests[s.test_id].chats,s.id,s)},addChatMessage:function(e,t){var s=t.message;console.log("addChatMessage",s),r["default"].set(e.tests[s.test_id].chats[s.chat_id].messages,s.sender_id+":"+s.message_id,s)},setLatestChatMessage:function(e,t){var s=t.message;r["default"].set(e.tests[s.test_id].chats[s.chat_id],"newest_message",s.sender_id+":"+s.message_id)},removeChatMessage:function(e,t){var s=t.message;r["default"].set(s,"visible",!1),r["default"].set(s,"content","This message has been deleted")},addUsers:function(e,t){var s=t.users;e.users=Object(h["a"])(Object(h["a"])({},e.users),s)},setLatestAnnouncementMessage:function(e,t){var s=t.message;r["default"].set(e.latest_announcement,"message",s)},setLatestAnnouncementShow:function(e,t){var s=t.show;r["default"].set(e.latest_announcement,"show",s)}},O={state:b,getters:C,actions:w,mutations:y},k={error:null,current_user:{}},E={has_error:function(e){return!!e.error},name:function(e){return e.current_user.name},is_user_id:function(e){return function(t){return e.current_user.user_id==t}}},j={throwError:function(e,t){return Object(m["a"])(regeneratorRuntime.mark((function s(){var n,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:n=e.commit,n("setError",t.error),r={timestamp:Date.now(),error:t.error,extra:""},_.a.post("/error",r).then((function(){})).catch((function(e){console.log("POST /error didn't work :(",e)}));case 4:case"end":return s.stop()}}),s)})))()},askDesktopNotificationPermission:function(){"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){}))},showDesktopNotification:function(e){var t=e.content;"Notification"in window&&("granted"===Notification.permission?new Notification("There is a new announcement!"):"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){"granted"===e&&new Notification(t)})))}},A={setError:function(e,t){e.error=t},unsetError:function(e){e.error=null},setCurrentUser:function(e,t){e.current_user=t}},T={state:k,getters:E,actions:j,mutations:A};r["default"].use(l["a"]);var N=new l["a"].Store({modules:{test:O,app:T}}),S=s("2106"),x=s.n(S),M=s("8c4f"),$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Navbar"),s("div",{staticClass:"wrapper"},[s("router-view")],1),s("b-modal",{attrs:{id:"error-modal",centered:""},on:{hidden:function(t){return e.unsetError()}},scopedSlots:e._u([{key:"modal-header",fn:function(){return[s("h5",{staticClass:"p-0 m-0",attrs:{"text-danger":""}},[e._v("An error occured")])]},proxy:!0},{key:"modal-footer",fn:function(){return[s("b-button",{attrs:{type:"submit",variant:"info"},on:{click:function(t){return e.unsetError()}}},[e._v("Close")])]},proxy:!0}])},[s("p",{staticClass:"my-4"},[e._v(e._s(e.error))])])],1)},U=[],I=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-navbar",{attrs:{toggleable:"sm",type:"dark",variant:"info",fixed:"top"}},[s("b-navbar-brand",{attrs:{to:{name:"Dashboard"}}},[e._v("Sekhmet")]),s("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),s("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[s("b-navbar-nav",[s("b-nav-text",[e._v(e._s(e.name))])],1),s("b-navbar-nav",{staticClass:"d-block d-sm-none"},[s("NavItem")],1)],1)],1),s("div",{staticClass:"sidebar bg-info d-none d-sm-block"},[s("b-nav",{staticClass:"w-25 nav-dark",attrs:{vertical:""}},[s("NavItem")],1)],1)],1)},P=[],L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",e._l(e.variableLinksToShow,(function(t){return s("b-nav-item",{key:t.path,attrs:{to:{name:t.path},append:""}},[e._v(e._s(t.name))])})),1),s("br"),s("br"),s("br"),s("div",e._l(e.constantLinks,(function(t){return s("b-nav-item",{key:t.path,attrs:{href:t.href?t.href:null,to:t.href?null:{name:t.path},append:""}},[e._v(e._s(t.name))])})),1)])},R=[],H=(s("4de4"),s("caad"),s("2532"),{name:"NavItem",computed:Object(h["a"])(Object(h["a"])({},Object(l["c"])(["active_test"])),Object(l["e"])({current_user_id:function(e){return e.app.current_user.user_id}})),watch:{$route:{immediate:!0,handler:function(){this.updateVariableLinksToShow()}},active_test:function(){this.updateVariableLinksToShow()},current_user_id:function(){this.updateVariableLinksToShow()}},methods:{updateVariableLinksToShow:function(){var e=this;this.variableLinksToShow=this.variableLinks.filter((function(t){return t.whitelist.includes(e.$route.name)&&(!0!==t.need_supervisor||e.active_test&&e.current_user_id&&!0===e.active_test.people[e.current_user_id].is_supervisor)}))}},data:function(){return{variableLinksToShow:[],variableLinks:[{name:"Chat",path:"test-chat",whitelist:["test-chat","test-people","test-settings"]},{name:"People",path:"test-people",whitelist:["test-chat","test-people","test-settings"],need_supervisor:!0},{name:"Settings",path:"test-settings",whitelist:["test-chat","test-people","test-settings"],need_supervisor:!0},{name:"Settings",path:"course",whitelist:["course","course-settings"]}],constantLinks:[{name:"Courses",path:"courses"},{name:"Logout",href:"/login?logout"}]}}}),D=H,G=Object(i["a"])(D,L,R,!1,null,null,null),W=G.exports,q={name:"Navbar",components:{NavItem:W},computed:Object(l["c"])(["name"])},J=q,K=(s("a118"),Object(i["a"])(J,I,P,!1,null,null,null)),B=K.exports,F={name:"Dashboard",components:{Navbar:B},created:function(){this.loadCurrentUser()},watch:{error:function(e){null!=e?this.$bvModal.show("error-modal"):this.$bvModal.hide("error-modal")}},computed:Object(h["a"])({},Object(l["e"])({error:function(e){return e.app.error}})),mounted:function(){this.$http.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="_csrf"]').content,this.askDesktopNotificationPermission()},methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["d"])(["unsetError","setCurrentUser"])),Object(l["b"])(["askDesktopNotificationPermission","throwError"])),{},{loadCurrentUser:function(){var e=this;this.axios.get("/users/me").then((function(t){var s=t.data;s.user_id=""+s.user_id,e.setCurrentUser(s)})).catch((function(t){return e.throwError({error:"Error while getting current user data"+t})}))}})},Y=F,V=(s("2b56"),Object(i["a"])(Y,$,U,!1,null,null,null)),z=V.exports,X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"login-square m-5 p-5 shadow rounded mx-auto"},[s("h1",[e._v("Sekhmet")]),s("p",[e._v("This page could not be found. (Error 404).")]),s("b-button",{staticClass:"btn btn-primary mt-3",attrs:{variant:"info",to:{name:"Dashboard"}}},[e._v(" Go to homepage ")])],1)])},Q=[],Z={name:"PageNotFound",data:function(){return{}},methods:{},computed:{}},ee=Z,te=Object(i["a"])(ee,X,Q,!1,null,null,null),se=te.exports,ne=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[0==Object.keys(e.courses).length?s("p",[e._v(" No courses/tests found :( #TODO nice display ")]):e._e(),0!==Object.keys(e.courses).length?s("div",{staticClass:"accordion",attrs:{role:"tablist"}},e._l(e.courses,(function(t){return s("b-card",{key:t.canvas_id,staticClass:"mb-1",attrs:{"no-body":""}},[s("b-card-header",{staticClass:"p-1",attrs:{"header-tag":"header",role:"tab"}},[s("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:"course-"+t.canvas_id,expression:"'course-' + course.canvas_id"}],attrs:{block:"",variant:"info"}},[e._v(e._s(t.name)+" "),e.current_user.is_employee?s("b-dropdown",{staticClass:"dropdown-dropleft float-right",attrs:{dropleft:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onCourseDetails(t)}}},[e._v("Course details")])],1):e._e()],1)],1),s("b-collapse",{attrs:{id:"course-"+t.canvas_id,visible:"",accordion:"courses-accordion",role:"tabpanel"}},[s("b-card-body",[s("b-table",{attrs:{striped:"",hover:"",items:Object.values(t.tests),fields:e.module_fields},on:{"row-clicked":e.testClickedHandler},scopedSlots:e._u([{key:"cell(open)",fn:function(t){return[s("b-button",{attrs:{size:"sm"},on:{click:function(s){return e.testClickedHandler(t.item)}}},[e._v(" Open test "),s("b-icon",{staticClass:"icon-play",attrs:{icon:"play-fill","aria-hidden":"true"}})],1)]}}],null,!0)})],1)],1)],1)})),1):e._e(),e.current_user.is_employee?s("b-button",{attrs:{to:{name:"course-import"}}},[e._v("New course")]):e._e()],1)},re=[],ae={name:"Courses",components:{},data:function(){return{module_fields:["name","open"],courses:{}}},methods:Object(h["a"])(Object(h["a"])({},Object(l["b"])(["throwError"])),{},{testClickedHandler:function(e){this.$router.push({name:"test-chat",params:{id:e.test_id}})},loadCourses:function(){var e=this;this.$http.get("/courses").then((function(t){t.data.courses?(e.courses=t.data.courses,e.current_user.is_employee||1===Object.values(e.courses).length&&1===Object.values(Object.values(e.courses)[0].tests).length&&"/"===e.$route.path&&e.$router.push({name:"test-chat",params:{id:Object.values(Object.values(e.courses)[0].tests)[0].test_id}}),console.log("loadCourses",e.courses,Object.values(Object.values(e.courses)[0].tests).length)):e.courses={}})).catch((function(t){e.throwError({error:"Error while loading courses: "+t})}))},onCourseDetails:function(e){this.$router.push({name:"course",params:{id:e.canvas_id}})}}),computed:Object(h["a"])({},Object(l["e"])({current_user:function(e){return e.app.current_user}})),created:function(){this.loadCourses()}},oe=ae,ie=(s("5024"),Object(i["a"])(oe,ne,re,!1,null,"f176e246",null)),ce=ie.exports,ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v(" Settings "),e.course.name?s("small",{staticClass:"text-muted"},[e._v(e._s(e.course.name))]):e._e()]),s("p",[e._v("In here you can change settings for this specific course.")]),s("b-form",{on:{submit:e.onSubmit}},[s("b-form-group",{attrs:{id:"input-group-name",label:"Name:","label-for":"input-name"}},[s("b-form-input",{attrs:{id:"input-name",type:"text",placeholder:"Enter test name",required:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("b-row",{staticClass:"mt-4"},[s("b-col",[e._v(" Module coordinator: "),s("b-card",{staticClass:"p-0",attrs:{"bg-variant":"light"}},[e._v(" "+e._s(e.form.coordinator.name)),s("br"),s("small",[e._v(e._s(e.form.coordinator.id)),s("br"),e._v(" "+e._s(e.form.coordinator.email))])]),e.form.coordinator.id!=e.course.coordinator.id?s("div",[s("small",{staticClass:"text-warning"},[e._v("If you change the coordinator, you loose access to this module.")])]):e._e(),s("b-button",{staticClass:"mt-3",attrs:{type:"submit",variant:"info"}},[e._v("Save")])],1),s("b-col",[e._v(" Search new coordinator "),s("b-form-input",{attrs:{id:"input-coordinator",type:"text",placeholder:"Search on m-number, name or email",list:"user-search-list",debounce:"500"},model:{value:e.form.search,callback:function(t){e.$set(e.form,"search",t)},expression:"form.search"}}),e.loadingSearch?s("div",{staticClass:"d-flex justify-content-center mt-2"},[s("b-spinner",{attrs:{label:"Loading..."}})],1):s("b-list-group",{staticClass:"mt-2 mb-4"},e._l(e.searchResults,(function(t){return s("b-list-group-item",{key:t.id,attrs:{href:"#"},on:{click:function(s){return e.selectCoordinator(t)}}},[e._v(" "+e._s(t.name)+" "),s("small",[e._v("- "+e._s(t.id)+", "+e._s(t.email))])])})),1)],1)],1)],1)],1)},de=[],le=(s("13d5"),s("841c"),{name:"CourseSettings",data:function(){return{course:{name:null,coordinator:{id:null}},initial_form:null,form:{search:null,name:"",coordinator:{id:null,name:null,email:null}},searchResults:[],loadingSearch:!1}},methods:Object(h["a"])(Object(h["a"])({},Object(l["b"])(["throwError"])),{},{onSubmit:function(e){var t=this;e.preventDefault();var s=this.formFieldsChanged();if(delete s.search,0!==s.length){var n=s;s.coordinator&&(n.module_coordinator=n.coordinator.user_id,delete n.coordinator),this.$http.put("/courses/"+this.$route.params.id,n).then((function(){"name"in s&&t.setTestName({name:s["name"]})})).catch((function(e){t.throwError({error:"Error while updating course"+e})}))}},formFieldsChanged:function(){var e=this,t=Object.keys(this.form).filter((function(t){return e.form[t]!==e.initial_form[t]}));return t.reduce((function(t,s){return t[s]=e.form[s],t}),{})},getCourse:function(){var e=this,t=this.$route.params.id;this.$http.get("/courses/"+t,this.form).then((function(s){if(s.data[t]){var n=s.data[t];e.form.name=n.name,e.form.coordinator=n.module_coordinator,e.initial_form=JSON.parse(JSON.stringify(e.form))}else e.throwError({error:"Error while getting course info: couldn't extract data from json"})})).catch((function(t){e.throwError({error:"Error while getting course info: "+t})}))},searchUser:function(e){var t=this;this.loadingSearch=!0,this.$http.get("/users/?q="+e,this.form).then((function(e){t.loadingSearch=!1,e.data.users?t.searchResults=e.data.users:t.throwError({error:"Error while getting users: cannot extract data from response"})})).catch((function(e){t.loadingSearch=!1,t.throwError({error:"Error while getting users: "+e})}))},selectCoordinator:function(e){this.form.coordinator=e,this.form.search=null,this.searchResults=[]}}),created:function(){this.getCourse()},watch:{"form.search":function(e){if(!e||e.length<4)return null;this.searchUser(e)}},computed:Object(h["a"])({},Object(l["e"])({current_user:function(e){return e.app.current_user}}))}),he=le,me=Object(i["a"])(he,ue,de,!1,null,null,null),pe=me.exports,_e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v("Import course")]),e.canvasButton?s("p",[e._v(" You did not yet set an API token for Canvas. "),s("b-button",{attrs:{to:{name:"canvas-token"},variant:"info"}},[e._v(" Set Canvas token ")])],1):s("p",[e._v(" Select the course you want to import from Canvas. Courses which are already imported in the system, won't be listed."),s("br"),e._v("You can always add more tests later on. It's also possible to add and remove people from a specific test. ")]),e.canvasButton?e._e():s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[e.loadingCourses?s("div",{staticClass:"d-flex justify-content-center mb-3"},[s("b-spinner",{attrs:{label:"Loading..."}})],1):!e.loadingCourses&&e.courses.length>0?s("b-list-group",e._l(e.courses,(function(t){return s("button",{key:t.id,staticClass:"list-group-item list-group-item-action",class:e.activeCourse==t.id?"border-info":"",attrs:{type:"button"},on:{click:function(s){return e.clickCourse(t.id)}}},[e._v(" "+e._s(t.name)+" "),s("br"),s("small",[e._v(e._s(t.course_code))])])})),0):s("div",[e._v(" No courses found. ")])],1),s("div",{staticClass:"col"},[e.loadingAssignmentsAndGroups?s("div",{staticClass:"d-flex justify-content-center mb-3"},[s("b-spinner",{attrs:{label:"Loading..."}})],1):e._e(),e.activeCourse>0&&!e.loadingAssignmentsAndGroups?[s("b-list-group",[e._l(e.assignments,(function(t,n){return s("b-list-group-item",{key:n},[s("b-form-checkbox",{attrs:{id:"checkbox-assignment-"+n,name:"checkbox-assignment-"+n},model:{value:t.selected,callback:function(s){e.$set(t,"selected",s)},expression:"assignment.selected"}},[e._v(" "+e._s(t.name)+" ")]),t.selected?s("b-form-group",{staticClass:"pl-4 pt-2 mb-1",attrs:{inline:""}},[s("b-form-radio",{attrs:{name:"students-assignment-"+n,value:!0},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"assignment.all_students"}},[e._v("All students of this course")]),s("b-form-radio",{attrs:{name:"students-assignment-"+n,value:!1},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"assignment.all_students"}},[e._v("Specific groupsets")])],1):e._e(),t.selected&&!1===t.all_students?s("b-form-checkbox-group",{staticClass:"pl-5",attrs:{options:e.groupsetOptions,name:"groupsets-assignment-"+n,label:"Select groupsets",stacked:""},model:{value:t.groupsets,callback:function(s){e.$set(t,"groupsets",s)},expression:"assignment.groupsets"}}):e._e()],1)})),e._l(e.customTests,(function(t,n){return s("b-list-group-item",{key:"custom-"+n},[s("b-input-group",{staticClass:"my-1"},[s("b-form-input",{attrs:{placeholder:"Enter custom test name"},model:{value:t.name,callback:function(s){e.$set(t,"name",s)},expression:"customTest.name"}}),s("b-input-group-append",[s("b-button",{attrs:{size:"sm"},on:{click:function(t){return e.deleteCustomTest(n)}}},[s("b-icon",{attrs:{icon:"trash","aria-hidden":"true"}})],1)],1)],1),s("b-form-group",{staticClass:"pl-4 pt-2 mb-1",attrs:{inline:""}},[s("b-form-radio",{attrs:{name:"students-customtest-"+n,value:!0},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"customTest.all_students"}},[e._v("All students of this course")]),s("b-form-radio",{attrs:{name:"students-customtest-"+n,value:!1},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"customTest.all_students"}},[e._v("Specific groupsets")])],1),!1===t.all_students?s("b-form-checkbox-group",{staticClass:"pl-5",attrs:{options:e.groupsetOptions,name:"groupsets-customtest-"+n,label:"Select groupsets",stacked:""},model:{value:t.groupsets,callback:function(s){e.$set(t,"groupsets",s)},expression:"customTest.groupsets"}}):e._e()],1)})),s("button",{staticClass:"list-group-item list-group-item-action",attrs:{type:"button"},on:{click:function(t){return e.addCustomTest()}}},[s("b-icon",{staticClass:"mr-2",attrs:{icon:"plus-circle","aria-hidden":"true"}}),s("span",{staticClass:"text-muted"},[e._v("Add custom test")])],1)],2),s("b-overlay",{attrs:{show:e.loadingImport,rounded:"",opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[s("b-button",{staticClass:"mt-3",attrs:{block:"",variant:"info",disabled:e.assignments.length+e.customTests.length<1||e.loadingImport},on:{click:function(t){return e.postCourseImport()}}},[e._v("Import course")])],1)]:e._e()],2)])])},fe=[],ge=(s("99af"),s("a434"),{name:"CourseImport",data:function(){return{courses:[],activeCourse:null,assignments:[],groupsets:[],selectedAssignments:[],selectedStudents:{},selected:null,customTests:[],loadingCourses:!1,loadingAssignmentsAndGroups:!1,loadingImport:!1,canvasButton:!1}},created:function(){this.getCourses()},computed:{groupsetOptions:function(){for(var e=[],t=0;t<this.groupsets.length;t++)e.push({text:this.groupsets[t].name,value:this.groupsets[t].canvasId});return e}},methods:Object(h["a"])(Object(h["a"])({},Object(l["b"])(["throwError"])),{},{getCourses:function(){this.loadingCourses=!0;var e=this;this.$http.get("/canvas/courses").then((function(t){e.loadingCourses=!1,e.courses=t.data,console.log(t)})).catch((function(t){e.loadingCourses=!1,401==t.response.status?e.canvasButton=!0:e.throwError({error:"Could not load courses from Canvas: "+t}),console.log(t)}))},getAssignmentsAndGroups:function(e){this.loadingAssignmentsAndGroups=!0;var t=this;this.$http.get("/canvas/courses/"+e+"/assignments_and_groups").then((function(e){t.loadingAssignmentsAndGroups=!1,t.assignments=t.createAssignmentList(e.data.assignments),t.groupsets=e.data.groupsets,console.log(e)})).catch((function(e){t.loadingAssignmentsAndGroups=!1,t.throwError({error:"Could not retrieve assignments and groupsets from canvas: "+e}),console.log(e)}))},postCourseImport:function(){this.loadingImport=!0;var e=this,t=this.assignments.filter((function(e){return 1==e.selected})).concat(this.customTests);console.log(t),this.$http.post("/canvas/courses/"+e.activeCourse,t,{withCredentials:!0}).then((function(){e.loadingImport=!1,e.$router.push({name:"course",params:{id:e.activeCourse}})})).catch((function(t){e.loadingImport=!1,e.throwError({error:"Importing course from canvas failed: "+t}),console.log(t)}))},createAssignmentList:function(e){for(var t=[],s=0;s<e.length;s++)t.push({selected:!1,name:e[s],all_students:null,groupsets:[]});return t},clickCourse:function(e){this.getAssignmentsAndGroups(e),this.activeCourse=e},addCustomTest:function(){this.customTests.push({name:"",all_students:null,groupsets:[]})},deleteCustomTest:function(e){this.customTests.splice(e,1)}})}),ve=ge,be=Object(i["a"])(ve,_e,fe,!1,null,null,null),Ce=be.exports,we=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v("Import tests")]),e.canvasButton?s("p",[e._v(" You did not yet set an API token for Canvas. "),s("b-button",{attrs:{to:{name:"canvas-token"},variant:"info"}},[e._v(" Set Canvas token ")])],1):s("p",[e._v(" Select the tests you want to import from Canvas. You can always add more tests later on. It's also possible to add and remove people from a specific test. ")]),e.canvasButton?e._e():s("div",[e.loadingAssignmentsAndGroups?s("div",{staticClass:"d-flex justify-content-center mb-3"},[s("b-spinner",{attrs:{label:"Loading..."}})],1):e._e(),e.loadingAssignmentsAndGroups?e._e():[s("b-list-group",[e._l(e.assignments,(function(t,n){return s("b-list-group-item",{key:n},[s("b-form-checkbox",{attrs:{id:"checkbox-assignment-"+n,name:"checkbox-assignment-"+n},model:{value:t.selected,callback:function(s){e.$set(t,"selected",s)},expression:"assignment.selected"}},[e._v(" "+e._s(t.name)+" ")]),t.selected?s("b-form-group",{staticClass:"pl-4 pt-2 mb-1",attrs:{inline:""}},[s("b-form-radio",{attrs:{name:"students-assignment-"+n,value:!0},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"assignment.all_students"}},[e._v("All students of this course")]),s("b-form-radio",{attrs:{name:"students-assignment-"+n,value:!1},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"assignment.all_students"}},[e._v("Specific groupsets")])],1):e._e(),t.selected&&!1===t.all_students?s("b-form-checkbox-group",{staticClass:"pl-5",attrs:{options:e.groupsetOptions,name:"groupsets-assignment-"+n,label:"Select groupsets",stacked:""},model:{value:t.groupsets,callback:function(s){e.$set(t,"groupsets",s)},expression:"assignment.groupsets"}}):e._e()],1)})),e._l(e.customTests,(function(t,n){return s("b-list-group-item",{key:"custom-"+n},[s("b-input-group",{staticClass:"my-1"},[s("b-form-input",{attrs:{placeholder:"Enter custom test name"},model:{value:t.name,callback:function(s){e.$set(t,"name",s)},expression:"customTest.name"}}),s("b-input-group-append",[s("b-button",{attrs:{size:"sm"},on:{click:function(t){return e.deleteCustomTest(n)}}},[s("b-icon",{attrs:{icon:"trash","aria-hidden":"true"}})],1)],1)],1),s("b-form-group",{staticClass:"pl-4 pt-2 mb-1",attrs:{inline:""}},[s("b-form-radio",{attrs:{name:"students-customtest-"+n,value:!0},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"customTest.all_students"}},[e._v("All students of this course")]),s("b-form-radio",{attrs:{name:"students-customtest-"+n,value:!1},model:{value:t.all_students,callback:function(s){e.$set(t,"all_students",s)},expression:"customTest.all_students"}},[e._v("Specific groupsets")])],1),!1===t.all_students?s("b-form-checkbox-group",{staticClass:"pl-5",attrs:{options:e.groupsetOptions,name:"groupsets-customtest-"+n,label:"Select groupsets",stacked:""},model:{value:t.groupsets,callback:function(s){e.$set(t,"groupsets",s)},expression:"customTest.groupsets"}}):e._e()],1)})),s("button",{staticClass:"list-group-item list-group-item-action",attrs:{type:"button"},on:{click:function(t){return e.addCustomTest()}}},[s("b-icon",{staticClass:"mr-2",attrs:{icon:"plus-circle","aria-hidden":"true"}}),s("span",{staticClass:"text-muted"},[e._v("Add custom test")])],1)],2),s("b-overlay",{attrs:{show:e.loadingImport,rounded:"",opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[s("b-button",{staticClass:"mt-3",attrs:{block:"",variant:"info",disabled:e.assignments.length+e.customTests.length<1||e.loadingImport},on:{click:function(t){return e.postCourseImport()}}},[e._v("Import course")])],1)]],2)])},ye=[],Oe={name:"CourseImport",data:function(){return{courses:[],assignments:[],groupsets:[],selectedAssignments:[],selectedStudents:{},selected:null,customTests:[],loadingCourses:!1,loadingAssignmentsAndGroups:!1,loadingImport:!1,canvasButton:!1}},created:function(){this.getAssignmentsAndGroups(this.$route.params.id)},computed:{groupsetOptions:function(){for(var e=[],t=0;t<this.groupsets.length;t++)e.push({text:this.groupsets[t].name,value:this.groupsets[t].canvasId});return e}},methods:Object(h["a"])(Object(h["a"])({},Object(l["d"])(["setError"])),{},{getAssignmentsAndGroups:function(e){this.loadingAssignmentsAndGroups=!0;var t=this;this.$http.get("/canvas/courses/"+e+"/assignments_and_groups").then((function(e){t.loadingAssignmentsAndGroups=!1,t.assignments=t.createAssignmentList(e.data.assignments),t.groupsets=e.data.groupsets,console.log(e)})).catch((function(e){t.loadingAssignmentsAndGroups=!1,t.setError("Could not retrieve assignments and groupsets from Canvas. Please try again."),console.log(e)}))},postCourseImport:function(){this.loadingImport=!0;var e=this,t=this.assignments.filter((function(e){return 1==e.selected})).concat(this.customTests);console.log(t),this.$http.post("/canvas/courses/"+e.$route.params.id,t,{withCredentials:!0}).then((function(){e.loadingImport=!1,e.$router.push({name:"course-settings",params:{id:e.$route.params.id}})})).catch((function(t){e.loadingImport=!1,e.setError("Importing course from Canvas failed. Please try again."),console.log(t)}))},createAssignmentList:function(e){for(var t=[],s=0;s<e.length;s++)t.push({selected:!1,name:e[s],all_students:null,groupsets:[]});return t},addCustomTest:function(){this.customTests.push({name:"",all_students:null,groupsets:[]})},deleteCustomTest:function(e){this.customTests.splice(e,1)}})},ke=Oe,Ee=Object(i["a"])(ke,we,ye,!1,null,null,null),je=Ee.exports,Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("router-view")],1)},Te=[],Ne={name:"Test",methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["d"])(["setActiveTestId","setUserConnectionById","setUserChannel"])),Object(l["b"])(["loadTest","loadUsers","receivedWsMessage","receivedChatMessage"])),{},{initWebSocket:function(){this.current_user.user_id&&(f(),g(this.receivedWsMessage))}}),computed:Object(h["a"])({},Object(l["e"])({current_user:function(e){return e.app.current_user},active_test_id:function(e){return e.test.active_test_id},tests:function(e){return e.test.tests}})),watch:{$route:{immediate:!0,handler:function(e){this.setActiveTestId(e.params.id)}},"current_user.user_id":function(e,t){e!=t&&this.initWebSocket()}},mounted:function(){this.loadTest({test_id:this.active_test_id}),this.initWebSocket()}},Se=Ne,xe=Object(i["a"])(Se,Ae,Te,!1,null,null,null),Me=xe.exports,$e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",[s("b-alert",{attrs:{variant:"info",show:e.is_spectator}},[s("h4",{staticClass:"alert-heading"},[e._v("Spectator mode")]),s("p",[e._v(" You're not enrolled in this test, thus you cannot send any messages. ")])]),s("h1",[e._v(" Test chat "),e.active_test?s("small",{staticClass:"text-muted"},[e._v(e._s(e.active_test.name))]):e._e()]),s("b-alert",{attrs:{dismissible:"",variant:"success",show:e.latest_announcement.show},on:{dismissed:function(t){return e.hideLatestAnnouncement()}}},[s("h4",{staticClass:"alert-heading"},[e._v("New announcement!")]),s("p",[e._v(" "+e._s(e.latest_announcement.message.content)+" ")])]),s("b-row",[s("b-col",{attrs:{cols:"4"}},[s("ChatList")],1),s("b-col",[s("MessageList"),s("ChatInput")],1)],1)],1)},Ue=[],Ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-list-group",[s("h5",[e._v("Unread chats: "+e._s(e.unreadChatsCount))]),s("div",{attrs:{id:"chat_list"}},e._l(e.orderedChats,(function(t){return s("b-list-group-item",{key:t.id,staticClass:"chat flex-column align-items-start",attrs:{href:"#"},on:{click:function(s){return e.onChangeChat(t)}}},[s("div",{staticClass:"d-flex"},[s("h5",{staticClass:"mb-1 chat-tr chat-truncate"},[e._v(e._s(t.name))]),s("small",[e._v("3 min")])]),s("div",{staticClass:"d-flex justify-content-between align-items-center"},[s("small",{staticClass:"chat-truncate"},[e._v(e._s(e.lastMessageOfChat(t)))]),t.assigned?s("b-badge",{staticClass:"mr-1",attrs:{variant:"info"}},[e._v(e._s(t.assigned))]):e._e(),t.unread&&0!==t.unread?s("b-badge",{staticClass:"align-self-center",attrs:{variant:"primary",pill:""}},[e._v(e._s(t.unread)+" ")]):e._e(),s("b-dropdown",{staticClass:"dropdown-dropright",attrs:{dropright:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[t.unread&&0!==t.unread?e._e():s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onMarkUnread(t)}}},[e._v("Mark as unread")]),t.unread&&0!==t.unread?s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onMarkRead(t)}}},[e._v("Mark as read")]):e._e(),"you"===t.assigned?s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onRemoveAssignment(t)}}},[e._v("Remove assignment")]):e._e()],1)],1)])})),1)])},Pe=[],Le={name:"ChatList",computed:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["c"])(["active_test"])),Object(l["e"])({current_user_id:function(e){return e.app.current_user.user_id},CHAT_ANNOUNCEMENTS_NAME:function(e){return e.test.CHAT_ANNOUNCEMENTS_NAME},CHAT_GROUP_NAME:function(e){return e.test.CHAT_GROUP_NAME}})),{},{chats:function(){if(this.active_test){var e=this.active_test.chats;return 0===e.length&&this.throwError({error:"Error while loading chats: there are not chats for this test."}),e}return[]},orderedChats:function(){var e=this.chats,t=Object.values(e).sort((function(e,t){return e.type-t.type||void 0!=t.messages[t.newest_message]&&void 0!=e.messages[t.newest_message]&&new Date(t.messages[t.newest_message].timestamp)-new Date(e.messages[e.newest_message].timestamp)}));return t},unreadChatsCount:function(){return Object.values(this.chats).filter((function(e){return e.unread>0})).length}}),methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["b"])(["informOthersChatUnread","updateChatUnread","sendWsMessage","throwError"])),Object(l["d"])(["setChatUnread","setActiveChat","setChatAssigned"])),{},{onChangeChat:function(e){this.setActiveChat(e),this.updateChatUnread({chat:e,number_of_unread:0})},onMarkRead:function(e){this.updateChatUnread({chat:e,number_of_unread:1})},onMarkUnread:function(e){this.updateChatUnread({chat:e,number_of_unread:1})},onRemoveAssignment:function(e){this.setChatAssigned({chat:e,name:null});var t=Object.values(e.people),s=[];for(var n in t)this.active_test.people[t[n].user_id]&&!0===this.active_test.people[t[n].user_id].is_supervisor&&s.push(""+t[n].user_id);var r={messageType:"conversation_assigned",receiverIds:s,message:{test_id:e.test_id,chat_id:e.chat_id,user_id:"NULL"}};this.sendWsMessage({message:r})},lastMessageOfChat:function(e){return e.messages[e.newest_message]?e.messages[e.newest_message].content:""}})},Re=Le,He=(s("0427"),s("a556"),Object(i["a"])(Re,Ie,Pe,!1,null,"7d63bff6",null)),De=He.exports,Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[null==e.active_chat||e.active_chat.name==e.CHAT_ANNOUNCEMENTS_NAME&&!e.active_test.people[e.current_user_id].is_supervisor?e._e():[s("p",{staticClass:"mb-0",attrs:{id:"users_typing"}},[s("small",[e._v(e._s(e.users_typing))])]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.onSendMessage(t)}}},[s("b-form-group",[s("b-form-textarea",{attrs:{id:"chat-message",placeholder:"Enter message..."},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:void t.preventDefault()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.shiftKey?t.ctrlKey||t.altKey||t.metaKey?null:e.addNewlineToMessage(t):null}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.onSendMessage(t)}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v(" Send ")])],1)]],2)},We=[],qe=(s("a15b"),s("4fad"),s("1276"),s("3835")),Je=s("2ef0"),Ke=s.n(Je),Be={name:"ChatInput",data:function(){return{message:"",temp_chat:null,typing:!1}},computed:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["c"])(["active_test"])),Object(l["e"])({active_chat:function(e){return e.test.active_chat},current_user_id:function(e){return e.app.current_user.user_id},CHAT_ANNOUNCEMENTS_NAME:function(e){return e.test.CHAT_ANNOUNCEMENTS_NAME},CHAT_GROUP_NAME:function(e){return e.test.CHAT_GROUP_NAME}})),{},{users_typing:function(){if(this.active_chat.typing){for(var e=[],t=0,s=Object.entries(this.active_chat.typing);t<s.length;t++){var n=Object(qe["a"])(s[t],2),r=n[0],a=n[1];if(a&&this.active_chat.people[r]){var o=this.active_chat.people[r].name;e.push(o.substr(0,o.indexOf(",")))}}return 0!==e.length?"People typing: "+e.join(", "):null}return null}}),methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["d"])(["addChatMessage","setCurrentUser","setChatAssigned"])),Object(l["b"])(["sendWsMessage"])),{},{addNewlineToMessage:function(){this.messagevalue="".concat(this.message,"\n")},onSendMessage:function(){if(0!==this.message.length){var e;e=this.active_chat.newest_message?parseInt((""+this.active_chat.newest_message).split(":")[1])+1:0;var t={message_id:""+e,sender_id:this.current_user_id,test_id:this.active_test.test_id,chat_id:this.active_chat.chat_id,timestamp:Date.now(),message_index:0,is_final:!0,content:this.message,visible:!0},s=Object.values(this.active_chat.people),n=[];for(var r in s)n.push(""+s[r].user_id);var a={messageType:"message_final",receiverIds:n,message:t};this.sendWsMessage({message:a}),this.addChatMessage({message:t}),this.message=""}},assignChatToMe:function(){this.setChatAssigned({chat:this.active_chat,name:"you"});var e=Object.values(this.active_chat.people),t=[];for(var s in e)this.active_test.people[e[s].user_id]&&!0===this.active_test.people[e[s].user_id].is_supervisor&&t.push(""+e[s].user_id);var n={messageType:"conversation_assigned",receiverIds:t,message:{test_id:this.active_test.test_id,chat_id:this.active_chat.chat_id,user_id:this.current_user_id}};this.sendWsMessage({message:n})},debounceUserStopTyping:Ke.a.debounce((function(){if(0===this.message.length){this.typing=!1;var e={test_id:this.active_test.test_id,chat_id:this.active_chat.chat_id,user_id:this.current_user_id,typing:!1},t=Object.values(this.active_chat.people),s=[];for(var n in t)s.push(""+t[n].user_id);var r={messageType:"conversation_typing",receiverIds:s,message:e};this.sendWsMessage({message:r})}}),800),userIsTyping:function(){if(!this.typing&&0!==this.message.length){this.typing=!0;var e={test_id:this.active_test.test_id,chat_id:this.active_chat.chat_id,user_id:this.current_user_id,typing:!0},t=Object.values(this.active_chat.people),s=[];for(var n in t)this.active_test.people[t[n].user_id]&&!0===this.active_test.people[t[n].user_id].is_supervisor&&s.push(""+t[n].user_id);var r={messageType:"conversation_typing",receiverIds:s,message:e};this.sendWsMessage({message:r})}}}),watch:{message:function(){this.active_test.people[this.current_user_id].is_supervisor&&(this.userIsTyping(),this.debounceUserStopTyping(),this.active_chat.name==this.CHAT_ANNOUNCEMENTS_NAME||this.active_chat.name==this.CHAT_GROUP_NAME||this.active_chat.assigned||this.assignChatToMe())},"active_chat.chat_id":function(){console.log("active_chat id changed"),this.temp_chat!=this.active_chat.chat_id&&(this.active_test.chats[this.temp_chat]&&(this.active_test.chats[this.temp_chat].temp_message=this.message),this.message="",this.active_chat.temp_message&&(this.message=JSON.parse(JSON.stringify(this.active_chat.temp_message))),this.temp_chat=this.active_chat.chat_id)}}},Fe=Be,Ye=(s("e9fd"),Object(i["a"])(Fe,Ge,We,!1,null,"fd52d33c",null)),Ve=Ye.exports,ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-modal",{ref:"edit-message-modal",attrs:{id:"edit-message-modal",title:"Edit chat message"},on:{ok:e.modalEditMessageOk}},[s("form",{ref:"form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit(t)}}},[s("b-form-group",{attrs:{label:"Message","label-for":"message-input","invalid-feedback":"Message may not be empty",state:e.message_content_new_state}},[s("b-form-textarea",{attrs:{id:"message-input",required:"",state:e.message_content_new_state},model:{value:e.message_content_new,callback:function(t){e.message_content_new=t},expression:"message_content_new"}})],1)],1)]),null!==e.active_chat?[s("h4",[e._v(e._s(e.active_chat.name))]),s("div",{staticClass:"message_list",attrs:{id:"message_list"}},[e._l(e.active_chat_messages,(function(t,n){return s("div",{key:n,staticClass:"message received mb-2 clearfix",class:{sent:e.chat_message_of_ours(t),deleted:!1===t.visible}},[s("div",{staticClass:"message-inner p-2"},[!1!==t.visible?s("p",{staticClass:"mb-0 pre-formatted"},[e._v(" "+e._s(t.content)+" ")]):e._e(),!1===t.visible?s("p",{staticClass:"mb-0 pre-formatted"},[e._v(" This message has been deleted ")]):e._e(),s("div",{staticClass:"d-flex justify-content-between align-items-center"},[s("small",{staticClass:"text-muted"},[e._v(e._s(e.timestamp_display(t))+" "+e._s(e.sender_display(t)))]),e.canUseMessageOptions(t)?s("b-dropdown",{staticClass:"dropdown-dropright",attrs:{dropright:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[e.canUseMessageDelete(t)?s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onEditMessage(t)}}},[e._v("Edit")]):e._e(),e.canUseMessageEdit(t)?s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onRemoveMessage(t)}}},[e._v("Remove")]):e._e()],1):e._e()],1)])])})),s("br")],2)]:e._e(),null===e.active_chat?[s("h4",[e._v("Welcome!")]),s("p",[e._v(" If you have any questions during your exam, click on the Questions chat at the left. Announcements will be posted to the Announcements chat. ")])]:e._e()],2)},Xe=[],Qe={name:"MessageList",data:function(){return{message_content_new:"",message_content_new_state:null,message_editing:{}}},computed:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["c"])(["is_user_id","active_test"])),Object(l["e"])({active_chat:function(e){return e.test.active_chat},current_user_id:function(e){return e.app.current_user.user_id},tests:function(e){return e.test.tests}})),{},{active_chat_messages:function(){return this.active_chat.messages}}),methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["b"])(["sendWsMessage"])),Object(l["d"])(["removeChatMessage"])),{},{chat_message_of_ours:function(e){return this.is_user_id(e.sender_id)||this.active_test.people[this.current_user_id].is_supervisor&&this.active_test.people[e.sender_id].is_supervisor},scrollMessageList:function(){return Object(m["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=document.getElementById("message_list"),t&&(t.scrollTop=t.scrollHeight);case 2:case"end":return e.stop()}}),e)})))()},onRemoveMessage:function(e){var t=Object.values(this.active_chat.people),s=[];for(var n in t)s.push(""+t[n].user_id);var r={messageType:"message_delete",receiverIds:s,message:{test_id:""+e.test_id,chat_id:""+e.chat_id,message_id:""+e.message_id,timestamp:""+e.timestamp,sender_id:""+e.sender_id}};this.sendWsMessage({message:r}),this.removeChatMessage({message:e})},onEditMessage:function(e){this.message_editing=e,this.message_content_new=this.message_editing.content,this.$refs["edit-message-modal"].show()},timestamp_display:function(e){var t=new Date(e.timestamp);return t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()},sender_display:function(e){if(this.active_test.people[this.current_user_id].is_supervisor){var t=this.active_test.people[e.sender_id].name;return" - "+t.substr(0,t.indexOf(","))}return""},modalEditMessageOk:function(e){var t=this;if(e.preventDefault(),this.message_content_new){this.message_editing.content=this.message_content_new,this.message_editing.timestamp=Date.now();var s=Object.values(this.active_chat.people),n=[];for(var r in s)n.push(""+s[r].user_id);var a={messageType:"message_final",receiverIds:n,message:this.message_editing};this.sendWsMessage({message:a}),this.$nextTick((function(){t.$bvModal.hide("edit-message-modal")}))}else this.message_content_new_state=!1},canUseMessageOptions:function(e){return this.canUseMessageDelete(e)||this.canUseMessageEdit(e)},canUseMessageDelete:function(e){return!1!==e.visible&&(!!this.active_test&&!!this.active_test.people[this.current_user_id].is_supervisor)},canUseMessageEdit:function(e){return!1!==e.visible&&(!!this.active_test&&e.sender_id==this.current_user_id)}}),watch:{"active_chat.newest_message":function(){var e=this;setTimeout((function(){e.scrollMessageList()}),200)}}},Ze=Qe,et=(s("5043"),Object(i["a"])(Ze,ze,Xe,!1,null,"33d55e0c",null)),tt=et.exports,st={name:"TestChat",data:function(){return{is_spectator:!1}},components:{ChatList:De,ChatInput:Ve,MessageList:tt},computed:Object(h["a"])(Object(h["a"])({},Object(l["e"])({current_user_id:function(e){return e.app.current_user.user_id},latest_announcement:function(e){return e.test.latest_announcement},tests:function(e){return e.test.tests}})),Object(l["c"])(["active_test"])),methods:Object(h["a"])(Object(h["a"])({},Object(l["d"])(["setLatestAnnouncementShow","decrementChatUnread"])),{},{hideLatestAnnouncement:function(){var e=this.tests[this.latest_announcement.message.test_id];if(e){var t=e.chats[this.latest_announcement.message.chat_id];t&&this.decrementChatUnread({chat:t})}this.setLatestAnnouncementShow({show:!1})}}),mounted:function(){}},nt=st,rt=Object(i["a"])(nt,$e,Ue,!1,null,null,null),at=rt.exports,ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v(" People "),e.active_test?s("small",{staticClass:"text-muted"},[e._v(e._s(e.active_test.name))]):e._e()]),s("p",[e._v("In here you can change the people and their permissions.")]),s("b-container",[s("b-row",[s("b-col",[s("b-list-group",{attrs:{flush:""}},[s("h4",[e._v("Students")]),s("div",{staticClass:"people_list"},e._l(e.students,(function(t){return s("b-list-group-item",{key:t.id,staticClass:"d-flex justify-content-between align-items-center",attrs:{href:"#",variant:t.variant}},[e._v(" "+e._s(t.name)+" "),s("b-dropdown",{staticClass:"dropdown-dropright",attrs:{dropright:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onRemoveStudent(t)}}},[e._v("Remove student")])],1)],1)})),1)])],1),s("b-col",[s("b-list-group",{attrs:{flush:""}},[s("h4",[e._v("Supervisors")]),s("div",{staticClass:"people_list"},e._l(e.supervisors,(function(t){return s("b-list-group-item",{key:t.id,staticClass:"d-flex justify-content-between align-items-center",attrs:{href:"#"}},[e._v(" "+e._s(t.name)+" "),s("b-dropdown",{staticClass:"dropdown-dropright",attrs:{dropright:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onRemoveSupervisor(t)}}},[e._v("Remove supervisor")])],1)],1)})),1)])],1),s("b-col",[s("b-list-group",{attrs:{flush:""}},[s("h4",[e._v("Module coordinator")]),s("b-list-group-item",{attrs:{href:"#"}},[e._v(" "+e._s(e.module_coordinator.name)+" ")])],1)],1)],1),s("hr"),s("b-row",[s("b-col",[s("h4",[e._v("Add new enrollment")]),s("b-form-input",{attrs:{id:"input-user",type:"text",placeholder:"Search on m-number, name or email",list:"user-search-list",debounce:"500"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.loadingSearch?s("div",{staticClass:"d-flex justify-content-center mt-2"},[s("b-spinner",{attrs:{label:"Loading..."}})],1):s("b-list-group",{staticClass:"mt-2 mb-4"},e._l(e.searchResults,(function(t){return s("b-list-group-item",{key:t.id,attrs:{href:"#"}},[e._v(" "+e._s(t.name)+" "),s("small",[e._v("- "+e._s(t.id)+", "+e._s(t.email))]),s("b-dropdown",{staticClass:"dropdown-dropright",attrs:{dropright:"",variant:"link","no-caret":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[s("b-icon",{staticClass:"icon-settings",attrs:{icon:"three-dots-vertical"}})]},proxy:!0}],null,!0)},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onAddStudent(t)}}},[e._v("Add as student")]),s("b-dropdown-item",{attrs:{href:"#"},on:{click:function(s){return s.stopPropagation(),e.onAddSupervisor(t)}}},[e._v("Add as supervisor")])],1)],1)})),1)],1)],1)],1)],1)},it=[],ct={name:"TestPeople",data:function(){return{students:{},supervisors:{},module_coordinator:{},search:"",loadingSearch:!1,searchResults:[]}},methods:Object(h["a"])(Object(h["a"])({},Object(l["b"])(["throwError"])),{},{onAddStudent:function(e){var t=this;if(e.user_id){var s={role:"S"};this.$http.post("/tests/"+this.$route.params.id+"/users/"+e.user_id,s).then((function(){t.$set(t.students,e.user_id,e),t.throwError({error:"Added this user to the test, but be aware that other users only receive this update on refresh"})})).catch((function(e){t.throwError({error:"Error while adding supervisor: "+e})}))}else this.throwError({error:"Error while adding supervisor: invalid user"})},onAddSupervisor:function(e){var t=this;if(e.user_id){var s={role:"T"};this.$http.post("/tests/"+this.$route.params.id+"/users/"+e.user_id,s).then((function(){t.$set(t.supervisors,e.user_id,e),t.throwError({error:"Added this supervisor to the test, but be aware that other users only receive this update on refresh"})})).catch((function(e){t.throwError({error:"Error while adding student: "+e})}))}else this.throwError({error:"Error while adding student: invalid user"})},onRemoveStudent:function(e){var t=this;this.$http.delete("/tests/"+this.$route.params.id+"/users/"+e.user_id).then((function(){t.$delete(t.students,e.user_id)})).catch((function(e){t.throwError({error:"Error while removing student enrollment: "+e})}))},onRemoveSupervisor:function(e){var t=this;this.$http.delete("/tests/"+this.$route.params.id+"/users/"+e.user_id).then((function(){t.$delete(t.supervisors,e.user_id)})).catch((function(e){t.throwError({error:"Error while removing supervisor enrollment: "+e})}))},getPeople:function(){var e=this;this.$http.get("/tests/"+this.$route.params.id+"/users").then((function(t){t.data.students?e.students=t.data.students:e.throwError({error:"Error while getting test people: students object not present"}),t.data.teachers?e.supervisors=t.data.teachers:e.throwError({error:"Error while getting test people: teachers object not present"}),t.data.module_coordinator?e.module_coordinator=t.data.module_coordinator:e.throwError({error:"Error while getting test people: module_coordinator object not present"})})).catch((function(t){return e.throwError({error:"Error while getting test people: "+t})}))},searchUser:function(e){var t=this;this.loadingSearch=!0,this.$http.get("/users/?q="+e,this.form).then((function(e){t.loadingSearch=!1,e.data.users?t.searchResults=e.data.users:t.throwError({error:"Error while getting users: cannot extract data from response"})})).catch((function(e){t.loadingSearch=!1,t.throwError({error:"Error while getting users: "+e})}))}}),computed:Object(h["a"])({},Object(l["c"])(["active_test"])),watch:{search:function(e){if(!e||e.length<4)return null;this.searchUser(e)}},mounted:function(){this.getPeople()}},ut=ct,dt=(s("12fe"),Object(i["a"])(ut,ot,it,!1,null,"79ec65ab",null)),lt=dt.exports,ht=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v(" Settings "),e.active_test?s("small",{staticClass:"text-muted"},[e._v(e._s(e.active_test.name))]):e._e()]),s("p",[e._v("In here you can change settings for this specific test.")]),s("b-form",{on:{submit:e.onSubmit}},[s("b-form-group",{attrs:{id:"input-group-name",label:"Name:","label-for":"input-name"}},[s("b-form-input",{attrs:{id:"input-name",type:"text",placeholder:"Enter test name",required:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("b-button",{attrs:{type:"submit",variant:"info"}},[e._v("Save")])],1),s("hr"),e.test_is_open?e._e():s("b-button",{on:{click:e.onStartTest}},[e._v(" Start test "),e.loading.start_test?s("b-spinner",{attrs:{small:""}}):e._e()],1),e.test_is_open?s("b-button",{staticClass:"ml-2",on:{click:e.onStopTest}},[e._v(" Stop test "),e.loading.stop_test?s("b-spinner",{attrs:{small:""}}):e._e()],1):e._e(),s("br"),s("hr"),s("b-button",{staticClass:"my-2",attrs:{disabled:""}},[e._v("Download chat backlog")]),s("br"),s("b-button",{attrs:{disabled:"",variant:"danger"}},[e._v("Delete complete test log")])],1)},mt=[],pt={name:"TestSettings",data:function(){return{initial_form:null,form:{test_id:null,name:""},loading:{start_test:!1,stop_test:!1}}},computed:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["c"])(["active_test"])),Object(l["e"])({current_user:function(e){return e.app.current_user}})),{},{test_is_open:function(){return this.active_test&&null!==this.active_test.start_time&&null===this.active_test.end_time}}),methods:Object(h["a"])(Object(h["a"])(Object(h["a"])({},Object(l["d"])(["setTestName"])),Object(l["b"])(["throwError","loadTest"])),{},{onSubmit:function(e){var t=this;e.preventDefault();var s=this.formFieldsChanged();0!==s.length?this.$http.put("/tests/"+this.$route.params.id,this.form).then((function(){"name"in s&&t.setTestName({test_id:t.form.test_id,name:s["name"]})})).catch((function(e){t.throwError({error:"Error while updating test: "+e})})):alert("nothin changed lol")},formFieldsChanged:function(){var e=this,t=Object.keys(this.form).filter((function(t){return e.form[t]!==e.initial_form[t]}));return t.reduce((function(t,s){return t[s]=e.form[s],t}),{})},onStartTest:function(){var e=this;this.loading.start_test=!0,this.$http.put("/tests/"+this.$route.params.id+"/open").then((function(){e.loading.start_test=!1,e.loadTest({test_id:e.$route.params.id})})).catch((function(t){e.loading.start_test=!1,e.throwError({error:"Error while starting test: "+t})}))},onStopTest:function(){var e=this;this.loading.stop_test=!0,this.$http.put("/tests/"+this.$route.params.id+"/close").then((function(){e.loading.stop_test=!1})).catch((function(t){e.loading.stop_test=!1,e.throwError({error:"Error while stopping test: "+t})}))}}),created:function(){},watch:{active_test:function(e){this.form.name=e.name,this.form.test_id=e.test_id,this.initial_form=JSON.parse(JSON.stringify(this.form))}},mounted:function(){this.active_test&&(this.form.name=this.active_test.name,this.form.test_id=this.active_test.test_id)}},_t=pt,ft=Object(i["a"])(_t,ht,mt,!1,null,null,null),gt=ft.exports,vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h1",[e._v(" Canvas API token settings ")]),e._m(0),e.has_canvas_token?s("p",[e._v("You currently have a token set. It's not shown because of security. If you save a new token, the old one will be overwritten.")]):s("p",[e._v("You currently have no token set.")]),s("b-form",{on:{submit:e.onSubmit}},[s("b-form-group",{attrs:{id:"input-group-name",label:"Canvas API token:","label-for":"input-name"}},[s("b-form-input",{attrs:{id:"input-name",type:"text",placeholder:"Paste your API token",required:""},model:{value:e.canvas_token,callback:function(t){e.canvas_token=t},expression:"canvas_token"}})],1),s("b-button",{staticClass:"mt-3",attrs:{type:"submit",variant:"info"}},[e._v("Save")])],1)],1)},bt=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("Go to "),s("a",{attrs:{href:"https://canvas.utwente.nl",target:"_blank"}},[e._v("Canvas")]),e._v(", log in and go to "),s("i",[e._v("Account")]),e._v(" > "),s("i",[e._v("Settings")]),e._v(". Scroll to "),s("i",[e._v("Approved integrations")]),e._v(", and click the pink button "),s("i",[e._v("New access token")]),e._v(". Follow the instructions and copy the token. Paste it here and save. You can close Canvas.")])}],Ct={name:"Courses",components:{},data:function(){return{module_fields:["name","open"],courses:{},has_canvas_token:!1,canvas_token:null}},methods:Object(h["a"])(Object(h["a"])({},Object(l["b"])(["throwError"])),{},{testClickedHandler:function(e){this.$router.push({name:"test-chat",params:{id:e.test_id}})},loadUser:function(){var e=this;this.$http.get("/users/me").then((function(t){t.data.has_canvas_token&&(e.has_canvas_token=t.data.has_canvas_token)})).catch((function(t){e.throwError({error:"Error while loading users: "+t})}))},onSubmit:function(e){e.preventDefault(),this.saveUser()},saveUser:function(){var e=this;this.$http.put("/users/me",{canvas_token:this.canvas_token}).then((function(){e.$router.push({name:"courses"})})).catch((function(t){e.throwError({error:"Error while saving: "+t})}))}}),computed:Object(h["a"])({},Object(l["e"])({current_user:function(e){return e.app.current_user}})),created:function(){this.loadUser()}},wt=Ct,yt=(s("c7b3"),Object(i["a"])(wt,vt,bt,!1,null,"2e3983f8",null)),Ot=yt.exports;r["default"].use(M["a"]);var kt=[{path:"/",name:"Dashboard",component:z,redirect:"courses",children:[{path:"/canvas-token",name:"canvas-token",component:Ot},{name:"courses",path:"/courses",component:ce},{name:"course-import",path:"/courses/import",component:Ce},{name:"course",path:"/courses/:id",component:pe},{name:"test-import",path:"/courses/:id/tests/import",component:je},{name:"tests",path:"/tests/",component:Me,redirect:"courses",children:[{name:"test-chat",path:"/tests/:id/chats",component:at},{name:"test-people",path:"/tests/:id/people",component:lt},{name:"test-settings",path:"/tests/:id/settings",component:gt}]}]},{path:"*",name:"PageNotFound",component:se}],Et=new M["a"]({mode:"history",base:"/",routes:kt}),jt=Et,At=s("5f5b"),Tt=s("b1e0");s("f9e3"),s("2dd8");r["default"].config.productionTip=!1,r["default"].use(At["a"]),r["default"].use(Tt["a"]),r["default"].use(l["a"]),_.a.defaults.baseURL="/api",_.a.defaults.headers.get["Accept"]="application/json",_.a.defaults.headers.post["Accept"]="application/json",_.a.defaults.headers.put["Accept"]="application/json",_.a.defaults.headers.delete["Accept"]="application/json",_.a.defaults.withCredentials=!0,r["default"].use(x.a,_.a),new r["default"]({store:N,router:jt,render:function(e){return e(d)}}).$mount("#app")},"64a6":function(e,t,s){},a118:function(e,t,s){"use strict";s("b4c3")},a556:function(e,t,s){"use strict";s("024a")},b4c3:function(e,t,s){},c285:function(e,t,s){},c7b3:function(e,t,s){"use strict";s("c285")},e4cd:function(e,t,s){},e65d:function(e,t,s){},e9fd:function(e,t,s){"use strict";s("fa9f")},edc9:function(e,t,s){},fa9f:function(e,t,s){}});
//# sourceMappingURL=app.c25a9521.js.map